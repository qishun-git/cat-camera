{% extends "base.html" %}
{% block content %}
<section>
    <h2>Live Stream</h2>
    {% if stream_url %}
    <p>The preview below is served by the recorder's MJPEG streamer.</p>
    <div class="player" style="max-width:800px;">
        <img src="{{ stream_url }}" alt="Live stream" style="width:100%; background:#000; border:1px solid #ccc;">
        <p id="viewerCount" style="margin-top:0.5rem; font-size:0.9rem; color:#333;">Viewers: --</p>
    </div>
    <script>
        async function refreshStatus() {
            try {
                const resp = await fetch("/stream/status");
                if (!resp.ok) {
                    throw new Error("status error");
                }
                const data = await resp.json();
                document.getElementById("viewerCount").textContent = "Viewers: " + (data.clients ?? 0);
            } catch (err) {
                document.getElementById("viewerCount").textContent = "Viewers: 0";
            }
        }
        refreshStatus();
        setInterval(refreshStatus, 5000);
    </script>
    {% else %}
    <p>Stream URL unavailable. Make sure you access the site via the Pi&rsquo;s IP/hostname or set <code>streaming.public_url</code> in <code>configs/cat_face.yaml</code>.</p>
    {% endif %}
</section>
{% endblock %}
